import{j as e,p as s,P as a,S as l,A as r,m as t,u as i,v as n,w as c,x as o,y as d,t as x,X as m,c as u,D as h,z as p,B as g,G as b,U as j,J as f,C as N,K as v,N as y,O as w,e as k,k as C,l as E,R as S,V as P}from"./ui-CC9fDAxl.js";import{r as D}from"./router-DKHyH_C6.js";import{f as q,l as L,S as A,T as B,i as R,m as I,n as z,o as M}from"./index-DmsZdVbW.js";import{u as $,a as T,C as O}from"./index.esm-kOr9XXcU.js";import{f as U}from"./format-8hQqAUQ4.js";import"./vendor-By4jc1MA.js";import"./differenceInCalendarDays-CQPmy639.js";const V=({raffles:x,onEdit:m,onDelete:u,onDuplicate:h,onCreate:p,loading:g=!1})=>{const[b,j]=D.useState(""),[f,N]=D.useState("all"),[v,y]=D.useState("date"),[w,k]=D.useState("desc"),[C,E]=D.useState(null),S=q(),P=async(e,s,a)=>{E(`${e}-${s}-${a}`);try{await L(e,s,a),S.success("Descarga exitosa",`Boletos ${s} descargados en formato ${a.toUpperCase()}`)}catch(l){console.error("Error downloading tickets:",l),S.error("Error al descargar",l.message||"No se pudieron descargar los boletos")}finally{E(null)}},A=D.useMemo(()=>{let e=x.filter(e=>{const s=e.title.toLowerCase().includes(b.toLowerCase())||(e.description||"").toLowerCase().includes(b.toLowerCase()),a="all"===f||e.status===f;return s&&a});return e.sort((e,s)=>{let a=0;switch(v){case"date":a=new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();break;case"title":a=e.title.localeCompare(s.title);break;case"tickets":a=e.tickets-s.tickets;break;case"sold":a=e.sold-s.sold}return"asc"===w?a:-a}),e},[x,b,f,v,w]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(s,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Rifas"}),e.jsx("p",{className:"text-gray-600",children:"Administra tus rifas"})]})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Rifa"})]})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar rifas...",value:b,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"hidden lg:flex items-center space-x-2",children:[e.jsxs("select",{value:f,onChange:e=>N(e.target.value),className:"px-3 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"active",children:"Activas"}),e.jsx("option",{value:"draft",children:"Borradores"}),e.jsx("option",{value:"finished",children:"Terminadas"})]}),e.jsxs("select",{value:v,onChange:e=>y(e.target.value),className:"px-3 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-sm",children:[e.jsx("option",{value:"date",children:"Fecha"}),e.jsx("option",{value:"title",children:"T√≠tulo"}),e.jsx("option",{value:"tickets",children:"Boletos"}),e.jsx("option",{value:"sold",children:"Vendidos"})]}),e.jsx("button",{onClick:()=>k("asc"===w?"desc":"asc"),className:"p-2.5 border border-gray-300 rounded-xl hover:bg-gray-50 transition-all duration-200",children:"asc"===w?"‚Üë":"‚Üì"})]})})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsx(r,{children:A.map(a=>e.jsxs(t.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:a.title}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:["üí∞ Precio: $",a.price]}),e.jsxs("p",{children:["üé´ Boletos: ",a.sold||0,"/",a.tickets]}),e.jsxs("p",{children:["üìÖ Sorteo: ",new Date(a.drawDate).toLocaleDateString("es-ES")]}),e.jsxs("p",{className:"font-bold "+("active"===a.status?"text-green-600":"draft"===a.status?"text-yellow-600":"text-red-600"),children:["üìä ","active"===a.status?"Activa":"draft"===a.status?"Borrador":"Terminada"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>m(a),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar"})]}),e.jsxs("button",{onClick:()=>h(a),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Duplicar"})]}),e.jsxs("button",{onClick:()=>u(a.id),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors text-sm",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:"Eliminar"})]}),e.jsxs("button",{onClick:()=>{},className:"flex items-center justify-center space-x-2 px-3 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors text-sm",children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:"Ver"})]})]}),a.sold>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Descargar Boletos"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Apartados"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>P(a.id,"apartados","csv"),disabled:C===`${a.id}-apartados-csv`,className:"flex items-center justify-center space-x-1 px-2 py-1 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-xs disabled:opacity-50",children:[e.jsx(o,{className:"w-3 h-3"}),e.jsx("span",{children:"CSV"})]}),e.jsxs("button",{onClick:()=>P(a.id,"apartados","excel"),disabled:C===`${a.id}-apartados-excel`,className:"flex items-center justify-center space-x-1 px-2 py-1 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-xs disabled:opacity-50",children:[e.jsx(d,{className:"w-3 h-3"}),e.jsx("span",{children:"Excel"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Pagados"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>P(a.id,"pagados","csv"),disabled:C===`${a.id}-pagados-csv`,className:"flex items-center justify-center space-x-1 px-2 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-xs disabled:opacity-50",children:[e.jsx(o,{className:"w-3 h-3"}),e.jsx("span",{children:"CSV"})]}),e.jsxs("button",{onClick:()=>P(a.id,"pagados","excel"),disabled:C===`${a.id}-pagados-excel`,className:"flex items-center justify-center space-x-1 px-2 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xs disabled:opacity-50",children:[e.jsx(d,{className:"w-3 h-3"}),e.jsx("span",{children:"Excel"})]})]})]})]})]})]},a.id))})}),0===A.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(s,{className:"w-16 h-16 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron rifas"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Intenta ajustar los filtros o crear una nueva rifa"}),e.jsx("button",{onClick:p,className:"bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-200",children:"Crear Nueva Rifa"})]})]})},F=({raffle:l,onClose:i,onSave:n,loading:o=!1})=>{var d,w,k,C,E;const[S,P]=D.useState("basic"),[L,A]=D.useState(!1),B=q(),{register:R,handleSubmit:I,control:z,watch:M,formState:{errors:V,isSubmitting:F}}=$({defaultValues:l?{...l,packs:(null==(d=l.packs)?void 0:d.length)?l.packs:[{q:1,price:100}],bonuses:(null==(w=l.bonuses)?void 0:w.map(e=>({value:e})))||[],gallery:l.gallery||[]}:{status:"draft",tickets:1e3,price:50,packs:[{q:1,price:100}],bonuses:[],gallery:[],sold:0}}),{fields:H,append:J,remove:G}=T({control:z,name:"bonuses"}),{fields:K,append:W,remove:X}=T({control:z,name:"packs"}),Q=M(),Y=[{id:"basic",label:"Informaci√≥n B√°sica",icon:u},{id:"pricing",label:"Precios y Paquetes",icon:h},{id:"images",label:"Im√°genes",icon:p},{id:"advanced",label:"Configuraci√≥n Avanzada",icon:g}],Z="w-full mt-1 p-3 border border-gray-300 rounded-xl bg-white text-gray-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",_="block text-sm font-semibold text-gray-700 mb-2";return e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",onClick:i,children:e.jsxs(t.div,{initial:{scale:.9,y:-20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:l?"Editar Rifa":"Crear Nueva Rifa"}),e.jsx("p",{className:"text-blue-100 mt-1",children:l?"Modifica los detalles de tu rifa":"Configura todos los aspectos de tu nueva rifa"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>A(!L),className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all duration-300 px-4 py-2 rounded-xl flex items-center space-x-2 border border-white/20",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:L?"Editar":"Vista Previa"})]}),e.jsx("button",{onClick:i,className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all duration-300 p-2 rounded-xl border border-white/20",children:e.jsx(m,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"flex h-[calc(95vh-120px)]",children:[e.jsxs("div",{className:"w-64 bg-gray-50 border-r border-gray-200 p-4",children:[e.jsx("nav",{className:"space-y-2",children:Y.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>P(s.id),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 "+(S===s.id?"bg-blue-500 text-white shadow-lg":"text-gray-600 hover:bg-gray-100"),children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.id)})}),e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-xl border border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"Estado Actual"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("active"===Q.status?"bg-green-100 text-green-800":"draft"===Q.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:Q.status})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Boletos:"}),e.jsx("span",{className:"font-medium",children:null==(k=Q.tickets)?void 0:k.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Paquetes:"}),e.jsx("span",{className:"font-medium",children:(null==(C=Q.packs)?void 0:C.length)||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Im√°genes:"}),e.jsx("span",{className:"font-medium",children:(null==(E=Q.gallery)?void 0:E.length)||0})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("form",{onSubmit:I(async e=>{try{if(!e.title||""===e.title.trim())return void B.error("T√≠tulo requerido","Por favor ingresa un t√≠tulo para la rifa");if(!e.tickets||e.tickets<1)return void B.error("Boletos requeridos","Debes especificar al menos 1 boleto");if(!e.price||e.price<=0)return void B.error("Precio requerido","El precio debe ser mayor a 0");if(!e.drawDate)return void B.error("Fecha requerida","Debes seleccionar la fecha del sorteo");const s={...e,bonuses:e.bonuses.map(e=>e.value)};await n({...l,...s}),B.success(l?"¬°Rifa actualizada!":"¬°Rifa creada!",l?"La rifa se actualiz√≥ correctamente":"La rifa se cre√≥ exitosamente"),i()}catch(s){console.error("Error saving raffle:",s),B.error("Error al guardar",s.message||"No se pudo guardar la rifa. Verifica todos los campos e intenta de nuevo.")}}),className:"p-6",children:[e.jsxs(r,{mode:"wait",children:["basic"===S&&e.jsxs(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(u,{className:"w-4 h-4 inline mr-2"}),"T√≠tulo de la Rifa"]}),e.jsx("input",{...R("title",{required:"El t√≠tulo es requerido"}),className:Z,placeholder:"Ej: iPhone 15 Pro Max"}),V.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.title.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(s,{className:"w-4 h-4 inline mr-2"}),"Fecha del Sorteo"]}),e.jsx(O,{name:"drawDate",control:z,rules:{required:!0},render:({field:s})=>e.jsx("input",{type:"datetime-local",value:s.value?U(new Date(s.value),"yyyy-MM-dd'T'HH:mm"):"",onChange:e=>s.onChange(new Date(e.target.value)),className:Z})}),V.drawDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"La fecha es requerida"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(b,{className:"w-4 h-4 inline mr-2"}),"Descripci√≥n"]}),e.jsx("textarea",{...R("description"),rows:4,className:Z,placeholder:"Describe el premio y los detalles de la rifa..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(j,{className:"w-4 h-4 inline mr-2"}),"Total de Boletos"]}),e.jsx("input",{type:"number",...R("tickets",{required:"El n√∫mero de boletos es requerido",min:1}),className:Z,placeholder:"1000"}),V.tickets&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.tickets.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(h,{className:"w-4 h-4 inline mr-2"}),"Precio por Boleto (LPS)"]}),e.jsx("input",{type:"number",step:"0.01",...R("price",{required:"El precio es requerido",min:{value:.01,message:"El precio debe ser mayor a 0"}}),className:Z,placeholder:"50.00"}),V.price&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.price.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(g,{className:"w-4 h-4 inline mr-2"}),"Estado"]}),e.jsxs("select",{...R("status"),className:Z,children:[e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"active",children:"Activa"}),e.jsx("option",{value:"finished",children:"Terminada"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),"Bonos y Premios Adicionales"]}),e.jsxs("div",{className:"space-y-3",children:[H.map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{...R(`bonuses.${a}.value`),className:`${Z} flex-1`,placeholder:"Ej: Descuento 10%, Boletos extra"}),e.jsx("button",{type:"button",onClick:()=>G(a),className:"p-3 bg-red-50 text-red-600 rounded-xl hover:bg-red-100 transition-all duration-200",children:e.jsx(c,{className:"w-4 h-4"})})]},s.id)),e.jsxs("button",{type:"button",onClick:()=>J({value:""}),className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-500 hover:text-blue-500 transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:"Agregar Bono"})]})]})]})]},"basic"),"pricing"===S&&e.jsxs(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(h,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"Configuraci√≥n de Precios"})]}),e.jsx("p",{className:"text-blue-700 text-sm",children:"Configura diferentes paquetes de boletos con precios especiales para incentivar las compras."})]}),e.jsxs("div",{className:"space-y-4",children:[K.map((s,a)=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-700",children:["Paquete ",a+1]}),K.length>1&&e.jsx("button",{type:"button",onClick:()=>X(a),className:"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all duration-200",children:e.jsx(c,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Nombre del Paquete"}),e.jsx("input",{...R(`packs.${a}.name`),className:Z,placeholder:"Ej: Pack B√°sico"})]}),e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Cantidad de Boletos"}),e.jsx("input",{type:"number",...R(`packs.${a}.tickets`,{min:1}),className:Z,placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Precio (LPS)"}),e.jsx("input",{type:"number",...R(`packs.${a}.price`,{min:0}),className:Z,placeholder:"50"})]})]})]},s.id)),e.jsxs("button",{type:"button",onClick:()=>W({name:"",tickets:1,price:50}),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-500 hover:text-blue-500 transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{children:"Agregar Nuevo Paquete"})]})]})]},"pricing"),"images"===S&&e.jsxs(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(p,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"Imagen Principal"})]}),e.jsx("p",{className:"text-green-700 text-sm",children:"Sube la imagen principal del premio (opcional). Se usar√° una imagen por defecto si no subes ninguna."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(p,{className:"w-4 h-4 inline mr-2"}),"URL de Imagen"]}),e.jsx("input",{...R("imageUrl"),className:Z,placeholder:"https://ejemplo.com/imagen.jpg"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Pega una URL de imagen o d√©jalo vac√≠o para usar imagen por defecto"}),Q.imageUrl&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:Q.imageUrl,alt:"Preview",className:"w-full max-w-md h-48 object-cover rounded-xl border border-gray-300",onError:e=>{e.target.src="https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=800&h=600&fit=crop"}})})]})]},"images"),"advanced"===S&&e.jsxs(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(g,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-purple-900",children:"Configuraci√≥n Avanzada"})]}),e.jsx("p",{className:"text-purple-700 text-sm",children:"Configuraciones adicionales para personalizar tu rifa."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Slug (URL amigable)"}),e.jsx("input",{...R("slug"),className:Z,placeholder:"iphone-15-pro-max"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Se genera autom√°ticamente si se deja vac√≠o"})]}),e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Boletos Vendidos"}),e.jsx("input",{type:"number",...R("sold",{min:0}),className:Z,placeholder:"0"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"N√∫mero inicial de boletos vendidos"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(b,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"M√∫ltiples Oportunidades"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",...R("boletosConOportunidades"),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{className:"text-gray-700 font-medium",children:"Boletos con M√∫ltiples Oportunidades"})]}),M("boletosConOportunidades")&&e.jsxs("div",{children:[e.jsx("label",{className:_,children:"N√∫mero de Oportunidades (1-10)"}),e.jsx("input",{type:"number",...R("numeroOportunidades",{min:1,max:10,valueAsNumber:!0}),className:Z,placeholder:"2",defaultValue:(null==l?void 0:l.numeroOportunidades)||2}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Cada boleto participar√° X veces en el sorteo"})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(N,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"font-semibold text-yellow-900",children:"Informaci√≥n Importante"})]}),e.jsxs("ul",{className:"text-yellow-800 text-sm space-y-1",children:[e.jsx("li",{children:"‚Ä¢ El slug debe ser √∫nico y no contener espacios"}),e.jsx("li",{children:"‚Ä¢ Los boletos vendidos no pueden exceder el total de boletos"}),e.jsx("li",{children:"‚Ä¢ Una vez activada, la rifa ser√° visible p√∫blicamente"}),e.jsx("li",{children:"‚Ä¢ Las im√°genes se optimizan autom√°ticamente"}),e.jsx("li",{children:"‚Ä¢ Las m√∫ltiples oportunidades permiten que cada boleto participe varias veces"})]})]})]},"advanced")]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200 mt-8",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-200",children:"Cancelar"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{type:"button",onClick:()=>A(!L),className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-200 flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:"Vista Previa"})]}),e.jsx("button",{type:"submit",disabled:F||o,className:"px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:from-blue-600 hover:to-purple-600 transition-all duration-200 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:F||o?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:l?"Actualizar Rifa":"Crear Rifa"})]})})]})]})]})})]})]})})},H=({images:s=[],onChange:a,maxImages:l=10,maxWidth:r=800,maxHeight:i=600,quality:n=.8})=>{const[c,o]=D.useState(!1),d=D.useRef(null),x=e=>new Promise((s,a)=>{const l=document.createElement("canvas"),t=l.getContext("2d"),c=new Image;c.onload=()=>{let{width:e,height:a}=c;if(e>r||a>i){const s=Math.min(r/e,i/a);e*=s,a*=s}l.width=e,l.height=a,null==t||t.drawImage(c,0,0,e,a);const o=l.toDataURL("image/jpeg",n);s(o)},c.onerror=()=>a(new Error("Error al cargar la imagen")),c.src=URL.createObjectURL(e)});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:d,type:"file",multiple:!0,accept:"image/*",onChange:async e=>{const r=Array.from(e.target.files||[]);if(0===r.length)return;if(s.length+r.length>l)return void alert(`M√°ximo ${l} im√°genes permitidas`);if(r.filter(e=>!e.type.startsWith("image/")).length>0)return void alert("Por favor selecciona solo archivos de imagen v√°lidos");if(r.filter(e=>e.size>10485760).length>0)alert("Algunas im√°genes son demasiado grandes. M√°ximo 10MB por imagen");else{o(!0);try{console.log("üìÅ Procesando im√°genes:",{cantidad:r.length,"tama√±oTotal":Math.round(r.reduce((e,s)=>e+s.size,0)/1024)+"KB"});const e=[];for(const s of r){const a=await x(s);e.push(a)}console.log("‚úÖ Im√°genes procesadas:",{cantidad:e.length,"tama√±oPromedio":Math.round(e.reduce((e,s)=>e+s.length,0)/e.length*.75/1024)+"KB"});const l=[...s,...e];a(l)}catch(t){console.error("‚ùå Error procesando im√°genes:",t),alert("Error al procesar las im√°genes")}finally{o(!1),d.current&&(d.current.value="")}}},className:"hidden"}),e.jsx("div",{onClick:()=>{var e;null==(e=d.current)||e.click()},className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-accent hover:bg-accent/5 transition-all",children:c?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Procesando im√°genes..."})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(w,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic para subir im√°genes"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["M√°ximo ",l," im√°genes, 10MB cada una"]})]})}),s.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Im√°genes (",s.length,"/",l,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:s.map((l,r)=>e.jsxs(t.div,{className:"relative group",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:l,alt:`Imagen ${r+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex space-x-1",children:[0!==r&&e.jsx("button",{onClick:()=>(e=>{if(0===e)return;const l=[...s];[l[0],l[e]]=[l[e],l[0]],a(l)})(r),className:"bg-blue-500 text-white p-1 rounded-full hover:bg-blue-600 transition-colors",title:"Hacer imagen principal",children:e.jsx(f,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(e=>{const l=s.filter((s,a)=>a!==e);a(l)})(r),className:"bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition-colors",title:"Eliminar imagen",children:e.jsx(m,{className:"w-4 h-4"})})]})}),0===r&&e.jsx("div",{className:"absolute top-1 left-1 bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:"Principal"})]},r))}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("p",{children:"‚Ä¢ La primera imagen ser√° la imagen principal del sorteo"}),e.jsx("p",{children:"‚Ä¢ Las dem√°s im√°genes aparecer√°n en la galer√≠a"}),e.jsx("p",{children:"‚Ä¢ Haz clic en la estrella para cambiar la imagen principal"})]})]})]})},J=({raffle:l,onClose:i,onSave:n,loading:o=!1})=>{var d,w;const[S,P]=D.useState("basic"),[q,L]=D.useState(!1),[A,B]=D.useState(!1),{register:R,handleSubmit:I,control:z,watch:M,formState:{errors:V,isSubmitting:F}}=$({defaultValues:l?{...l,packs:(null==(d=l.packs)?void 0:d.length)?l.packs:[{q:1,price:100}],bonuses:(null==(w=l.bonuses)?void 0:w.map(e=>({value:e})))||[],gallery:l.gallery||[]}:{status:"draft",tickets:1e3,packs:[{q:1,price:100}],bonuses:[],gallery:[],sold:0}}),{fields:J,append:G,remove:K}=T({control:z,name:"bonuses"}),{fields:W,append:X,remove:Q}=T({control:z,name:"packs"});M();const Y=[{id:"basic",label:"B√°sica",icon:u,shortLabel:"Info"},{id:"pricing",label:"Precios",icon:h,shortLabel:"Precios"},{id:"images",label:"Im√°genes",icon:p,shortLabel:"Fotos"},{id:"advanced",label:"Avanzada",icon:g,shortLabel:"M√°s"}],Z="w-full mt-1 p-3 border border-gray-300 rounded-xl bg-white text-gray-800 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-base",_="block text-sm font-semibold text-gray-700 mb-2";return e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4",onClick:i,children:e.jsxs(t.div,{initial:{y:"100%",scale:1},animate:{y:0,scale:1},exit:{y:"100%",scale:.95},className:"bg-white rounded-t-3xl sm:rounded-2xl shadow-2xl w-full h-[95vh] sm:h-auto sm:max-h-[95vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-4 sm:p-6 text-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg sm:text-2xl font-bold truncate",children:l?"Editar Rifa":"Nueva Rifa"}),e.jsx("p",{className:"text-blue-100 text-sm mt-1 hidden sm:block",children:l?"Modifica los detalles de tu rifa":"Configura todos los aspectos de tu nueva rifa"})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.jsxs("button",{onClick:()=>L(!q),className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all duration-300 px-2 sm:px-4 py-2 rounded-xl flex items-center space-x-1 sm:space-x-2 border border-white/20 text-sm",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:q?"Editar":"Vista Previa"})]}),e.jsx("button",{onClick:i,className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all duration-300 p-2 rounded-xl border border-white/20",children:e.jsx(m,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flex space-x-1 bg-white/10 backdrop-blur-sm rounded-xl p-1",children:Y.map(s=>{const a=s.icon,l=S===s.id;return e.jsxs("button",{onClick:()=>P(s.id),className:"flex-1 flex items-center justify-center space-x-1 sm:space-x-2 px-2 sm:px-3 py-2 rounded-lg transition-all duration-200 text-sm font-medium "+(l?"bg-white text-blue-600 shadow-sm":"text-white/80 hover:text-white hover:bg-white/10"),children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.shortLabel})]},s.id)})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:e.jsx("form",{onSubmit:I(e=>{const s={...e,bonuses:e.bonuses.map(e=>e.value)};n({...l,...s})}),className:"p-4 sm:p-6",children:e.jsxs(r,{mode:"wait",children:["basic"===S&&e.jsx(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(u,{className:"w-5 h-5 mr-2 text-blue-600"}),"Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:_,children:"T√≠tulo de la Rifa"}),e.jsx("input",{...R("title",{required:"El t√≠tulo es requerido"}),className:Z,placeholder:"Ej: iPhone 15 Pro Max"}),V.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.title.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(s,{className:"w-4 h-4 inline mr-2"}),"Fecha del Sorteo"]}),e.jsx(O,{name:"drawDate",control:z,rules:{required:!0},render:({field:s})=>e.jsx("input",{type:"datetime-local",value:s.value?U(new Date(s.value),"yyyy-MM-dd'T'HH:mm"):"",onChange:e=>s.onChange(new Date(e.target.value)),className:Z})}),V.drawDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"La fecha es requerida"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(b,{className:"w-4 h-4 inline mr-2"}),"Descripci√≥n"]}),e.jsx("textarea",{...R("description"),rows:4,className:Z,placeholder:"Describe el premio y los detalles de la rifa..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(j,{className:"w-4 h-4 inline mr-2"}),"Total de Boletos"]}),e.jsx("input",{...R("tickets",{required:"El n√∫mero de boletos es requerido",min:{value:1,message:"M√≠nimo 1 boleto"}}),type:"number",className:Z,placeholder:"1000"}),V.tickets&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:V.tickets.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),"Estado"]}),e.jsxs("select",{...R("status"),className:Z,children:[e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"active",children:"Activa"}),e.jsx("option",{value:"finished",children:"Finalizada"})]})]})]})]})]})},"basic"),"pricing"===S&&e.jsxs(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(h,{className:"w-5 h-5 mr-2 text-green-600"}),"Precios y Paquetes"]}),e.jsxs("div",{className:"space-y-4",children:[W.map((s,a)=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-700",children:["Paquete ",a+1]}),W.length>1&&e.jsx("button",{type:"button",onClick:()=>Q(a),className:"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all duration-200",children:e.jsx(c,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Cantidad de Boletos"}),e.jsx("input",{...R(`packs.${a}.q`,{required:!0,min:1}),type:"number",className:Z,placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:_,children:"Precio (LPS)"}),e.jsx("input",{...R(`packs.${a}.price`,{required:!0,min:0}),type:"number",className:Z,placeholder:"100"})]})]})]},s.id)),e.jsxs("button",{type:"button",onClick:()=>X({q:1,price:100}),className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-500 hover:text-blue-500 transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{children:"Agregar Paquete"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 mr-2 text-purple-600"}),"Bonificaciones"]}),e.jsxs("div",{className:"space-y-4",children:[J.map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{...R(`bonuses.${a}.value`),className:Z,placeholder:"Ej: 2 boletos gratis por cada 10 comprados"})}),e.jsx("button",{type:"button",onClick:()=>K(a),className:"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all duration-200",children:e.jsx(c,{className:"w-4 h-4"})})]},s.id)),e.jsxs("button",{type:"button",onClick:()=>G({value:""}),className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-purple-500 hover:text-purple-500 transition-all duration-200 flex items-center justify-center space-x-2",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:"Agregar Bonificaci√≥n"})]})]})]})]},"pricing"),"images"===S&&e.jsx(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(p,{className:"w-5 h-5 mr-2 text-pink-600"}),"Im√°genes del Premio"]}),e.jsx(O,{name:"gallery",control:z,render:({field:s})=>e.jsx(H,{images:s.value||[],onChange:s.onChange,maxImages:10})})]})},"images"),"advanced"===S&&e.jsx(t.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-4 sm:p-6 shadow-sm border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(g,{className:"w-5 h-5 mr-2 text-orange-600"}),"Configuraci√≥n Avanzada"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(v,{className:"w-4 h-4 inline mr-2"}),"Fecha de Inicio"]}),e.jsx(O,{name:"startDate",control:z,render:({field:s})=>e.jsx("input",{type:"datetime-local",value:s.value?U(new Date(s.value),"yyyy-MM-dd'T'HH:mm"):"",onChange:e=>s.onChange(new Date(e.target.value)),className:Z})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(N,{className:"w-4 h-4 inline mr-2"}),"T√©rminos y Condiciones"]}),e.jsx("textarea",{...R("terms"),rows:4,className:Z,placeholder:"Especifica los t√©rminos y condiciones de la rifa..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(j,{className:"w-4 h-4 inline mr-2"}),"Boletos Vendidos"]}),e.jsx("input",{...R("sold",{min:0}),type:"number",className:Z,placeholder:"0"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:_,children:[e.jsx(k,{className:"w-4 h-4 inline mr-2"}),"Mostrar en P√°gina Principal"]}),e.jsxs("select",{...R("featured"),className:Z,children:[e.jsx("option",{value:"true",children:"S√≠"}),e.jsx("option",{value:"false",children:"No"})]})]})]})]})]})},"advanced")]})})}),e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 sm:p-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:hidden",children:[e.jsxs("button",{type:"button",onClick:()=>{const e=Y.findIndex(e=>e.id===S);e>0&&P(Y[e-1].id)},disabled:"basic"===S,className:"flex items-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:"Anterior"})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Y.map((s,a)=>e.jsx("div",{className:"w-2 h-2 rounded-full "+(S===s.id?"bg-blue-500":"bg-gray-300")},s.id))}),e.jsxs("button",{type:"button",onClick:()=>{const e=Y.findIndex(e=>e.id===S);e<Y.length-1&&P(Y[e+1].id)},disabled:"advanced"===S,className:"flex items-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{children:"Siguiente"}),e.jsx(E,{className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:i,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-200 font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:F||o,className:"px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:from-blue-600 hover:to-purple-600 transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:F||o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:l?"Actualizar Rifa":"Crear Rifa"})]})})]})]})]})})},G=()=>{const s=(()=>{const[e,s]=D.useState(!1);return D.useEffect(()=>{const e=()=>{s(window.innerWidth<768||/iPhone|iPad|iPod|Android/i.test(navigator.userAgent))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e})(),l=q(),[i,n]=D.useState([]),[c,o]=D.useState(!0),[d,x]=D.useState(!1),[m,u]=D.useState(null),[h,p]=D.useState(!1),g=async()=>{p(!0);try{const e=await R();n(e)}catch(e){console.error("Error refreshing raffles:",e)}finally{p(!1)}};D.useEffect(()=>{(async()=>{o(!0);try{const e=await R();n(e)}catch(e){console.error("Error fetching raffles:",e)}finally{o(!1)}})()},[]);const b=(e=null)=>{u(e),x(!0)},j=()=>{u(null),x(!1)},f=async e=>{try{p(!0),console.log("üíæ Saving raffle:",{isEdit:!!m,originalData:e});const s=(e=>{if(!e.title||""===e.title.trim())throw new Error("El t√≠tulo es requerido");if(!e.tickets||e.tickets<1)throw new Error("El n√∫mero de boletos debe ser mayor a 0");if(!e.price||e.price<=0)throw new Error("El precio debe ser mayor a 0");if(!e.drawDate)throw new Error("La fecha del sorteo es requerida");const s=e.gallery||[];return{title:e.title.trim(),description:e.description||null,imageUrl:s.length>0?s[0]:e.imageUrl||e.heroImage||null,price:Number(e.price),tickets:Number(e.tickets),drawDate:new Date(e.drawDate),status:e.status||"draft",slug:e.slug||null,boletosConOportunidades:e.boletosConOportunidades||!1,numeroOportunidades:e.numeroOportunidades||1}})(e);let a;console.log("‚úÖ Cleaned data:",s),(null==m?void 0:m.id)?(console.log("üìù Updating existing raffle:",m.id),a=await z(m.id,s),l.success("¬°Rifa actualizada!","La rifa se actualiz√≥ correctamente")):(console.log("üÜï Creating new raffle"),a=await M(s),l.success("¬°Rifa creada!","La rifa se cre√≥ exitosamente")),console.log("‚úÖ Raffle saved successfully:",a),(null==m?void 0:m.id)?n(e=>e.map(e=>e.id===m.id?a:e)):n(e=>[a,...e]),j()}catch(s){console.error("‚ùå Error saving raffle:",s),l.error("Error al guardar",s.message||"No se pudo guardar la rifa. Verifica todos los campos e intenta de nuevo.")}finally{p(!1)}};return c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando rifas..."})]})}):e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Rifas"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Administra tus rifas de forma profesional"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:g,disabled:h,className:"flex items-center space-x-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all duration-200 disabled:opacity-50 text-sm",children:[e.jsx(S,{className:"w-4 h-4 "+(h?"animate-spin":"")}),e.jsx("span",{className:"hidden sm:inline",children:"Actualizar"})]}),e.jsxs("button",{onClick:()=>{const e=JSON.stringify(i,null,2),s="data:application/json;charset=utf-8,"+encodeURIComponent(e),a=`rifas-${(new Date).toISOString().split("T")[0]}.json`,l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download",a),l.click()},className:"flex items-center space-x-2 px-3 py-2 bg-green-100 text-green-700 rounded-xl hover:bg-green-200 transition-all duration-200 text-sm",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Exportar"})]}),e.jsxs("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){const e=new FileReader;e.onload=e=>{var s;try{const a=JSON.parse(null==(s=e.target)?void 0:s.result);console.log("Rifas importadas:",a),alert("Funcionalidad de importaci√≥n en desarrollo")}catch(a){alert("Error al leer el archivo JSON")}},e.readAsText(a)}},e.click()},className:"flex items-center space-x-2 px-3 py-2 bg-blue-100 text-blue-700 rounded-xl hover:bg-blue-200 transition-all duration-200 text-sm",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Importar"})]}),e.jsxs("button",{onClick:()=>b(),className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:from-blue-600 hover:to-purple-600 transition-all duration-200 shadow-lg text-sm",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Rifa"})]})]})]}),e.jsx(V,{raffles:i,onEdit:b,onDelete:async e=>{if(window.confirm("¬øEst√°s seguro de que quieres eliminar esta rifa? Esto no se puede deshacer."))try{p(!0),console.log("üóëÔ∏è Deleting raffle:",e),await I(e),await g(),console.log("‚úÖ Raffle deleted successfully"),l.success("Rifa eliminada","La rifa se elimin√≥ correctamente")}catch(s){console.error("‚ùå Error deleting raffle:",s),l.error("Error al eliminar",s instanceof Error?s.message:"No se pudo eliminar la rifa")}finally{p(!1)}},onDuplicate:e=>{const s={...e,id:void 0,title:`${e.title} (Copia)`,slug:`${e.slug}-copia-${Date.now()}`,status:"draft",sold:0,createdAt:void 0,updatedAt:void 0};console.log("üìã Duplicating raffle:",{original:e.title,duplicate:s.title}),b(s)},onCreate:()=>b(),loading:h}),e.jsx(r,{children:d&&(s?e.jsx(J,{raffle:m,onClose:j,onSave:f,loading:h}):e.jsx(F,{raffle:m,onClose:j,onSave:f,loading:h}))}),e.jsx(B,{})]})};export{G as default};
