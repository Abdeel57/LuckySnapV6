import{j as e,X as s,l as t,m as a,P as l,A as r,n as i}from"./ui-BjxIis6X.js";import{r as n}from"./router-Cu2lpERZ.js";import{u as d,a as c,C as o}from"./index.esm-7w44b31V.js";import{S as x,j as m,k as u,l as p,m as h}from"./index-jkHuebR5.js";import{f as g}from"./format-8hQqAUQ4.js";import"./vendor-DOHx2j1n.js";import"./differenceInCalendarDays-CQPmy639.js";const j=({value:a,onChange:l})=>e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Imagen Principal"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md cursor-pointer hover:border-blue-500 transition-colors",onClick:()=>{var e;null==(e=document.getElementById("file-upload"))||e.click()},children:e.jsxs("div",{className:"space-y-1 text-center",children:[a?e.jsxs("div",{className:"relative group mx-auto",children:[e.jsx("img",{src:a,alt:"Preview",className:"mx-auto h-40 w-auto rounded-md object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity rounded-md",children:e.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),l("")},type:"button",className:"text-white bg-red-500 rounded-full p-2 hover:bg-red-600 z-10","aria-label":"Remove image",children:e.jsx(s,{size:20})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsx("span",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none",children:e.jsx("span",{children:"Sube un archivo"})}),e.jsx("p",{className:"pl-1",children:"o arrástralo aquí"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF"})]}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"image/*",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){const e=new FileReader;e.onloadend=()=>{l(e.result)},e.readAsDataURL(t)}}})]})})]}),b=({raffle:t,onClose:r,onSave:n})=>{var x,m,u,p;const{register:h,handleSubmit:b,control:f,formState:{errors:y,isSubmitting:v}}=d({defaultValues:t?{...t,packs:(null==(x=t.packs)?void 0:x.length)?t.packs:[{q:1,price:100}],bonuses:(null==(m=t.bonuses)?void 0:m.map(e=>({value:e})))||[]}:{status:"draft",tickets:1e3,packs:[{q:1,price:100}],bonuses:[],gallery:[],sold:0}}),{fields:N,append:w,remove:k}=c({control:f,name:"bonuses"}),C="w-full mt-1 p-2 border rounded-md bg-white text-gray-800 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500";return e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",onClick:r,children:e.jsxs(a.div,{initial:{scale:.9,y:-20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:(null==t?void 0:t.id)?"Editar Rifa":"Nueva Rifa"}),e.jsx("button",{onClick:r,className:"p-2 rounded-full text-gray-500 hover:bg-gray-200",children:e.jsx(s,{})})]}),e.jsxs("form",{onSubmit:b(e=>{const s={...e,bonuses:e.bonuses.map(e=>e.value)};n({...t,...s})}),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Título"}),e.jsx("input",{...h("title",{required:"El título es requerido"}),className:C}),y.title&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Slug (URL amigable, ej. auto-deportivo-2024)"}),e.jsx("input",{...h("slug",{required:"El slug es requerido"}),className:C}),y.slug&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.slug.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Descripción"}),e.jsx("textarea",{...h("description"),className:C,rows:3})]}),e.jsxs("div",{children:[e.jsx(o,{name:"heroImage",control:f,rules:{required:"La imagen es requerida"},render:({field:s})=>e.jsx(j,{value:s.value,onChange:s.onChange})}),y.heroImage&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.heroImage.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha del Sorteo"}),e.jsx(o,{name:"drawDate",control:f,rules:{required:!0},render:({field:s})=>e.jsx("input",{type:"date",value:s.value?g(new Date(s.value),"yyyy-MM-dd"):"",onChange:e=>{e.target.value&&s.onChange(new Date(e.target.value+"T12:00:00Z"))},className:C})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total de Boletos"}),e.jsx("input",{type:"number",...h("tickets",{required:!0,valueAsNumber:!0,min:1}),className:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Precio por Boleto (LPS)"}),e.jsx("input",{type:"number",...h("packs.0.price",{required:"El precio es requerido",valueAsNumber:!0,min:{value:.01,message:"El precio debe ser positivo"}}),className:C,step:"0.01"}),(null==(p=null==(u=y.packs)?void 0:u[0])?void 0:p.price)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y.packs[0].price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsxs("select",{...h("status"),className:C,children:[e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"active",children:"Activa"}),e.jsx("option",{value:"finished",children:"Finalizada"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Bonos"}),N.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("input",{...h(`bonuses.${t}.value`),className:`${C} mt-0`}),e.jsx("button",{type:"button",onClick:()=>k(t),className:"p-2 text-red-500 hover:bg-red-100 rounded-full",children:e.jsx(i,{size:16})})]},s.id)),e.jsxs("button",{type:"button",onClick:()=>w({value:""}),className:"mt-2 text-sm text-blue-600 font-semibold flex items-center gap-1",children:[e.jsx(l,{size:14}),"Agregar Bono"]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t mt-6",children:[e.jsx("button",{type:"button",onClick:r,className:"py-2 px-4 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:v,className:"py-2 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:v?"Guardando...":"Guardar Rifa"})]})]})]})})},f=()=>{const[s,t]=n.useState([]),[i,d]=n.useState(!0),[c,o]=n.useState(!1),[j,f]=n.useState(null),y=async()=>{d(!0);const e=await m();t(e),d(!1)};n.useEffect(()=>{y()},[]);const v=(e=null)=>{f(e),o(!0)},N=()=>{f(null),o(!1)},w=async e=>{if(window.confirm("¿Estás seguro de que quieres eliminar esta rifa? Esto no se puede deshacer."))try{await u(e),y()}catch(s){alert("Error al eliminar la rifa.")}},k=s=>{switch(s){case"active":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full",children:"Activa"});case"finished":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-200 rounded-full",children:"Finalizada"});case"draft":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-yellow-800 bg-yellow-200 rounded-full",children:"Borrador"})}};return e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Rifas"}),e.jsxs("button",{onClick:()=>v(),className:"flex items-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700",children:[e.jsx(l,{size:20}),e.jsx("span",{children:"Nueva Rifa"})]})]}),e.jsx("div",{className:"bg-white p-4 md:p-6 rounded-lg shadow-md",children:i?e.jsx(x,{}):e.jsxs("div",{children:[e.jsx("div",{className:"md:hidden space-y-4",children:s.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"font-bold text-gray-800 pr-2",children:s.title}),e.jsx("div",{className:"flex-shrink-0",children:k(s.status)})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[e.jsx("p",{children:g(new Date(s.drawDate),"dd MMM, yyyy")}),e.jsxs("p",{children:[s.sold," / ",s.tickets," boletos"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>v(s),className:"flex-1 py-2 px-3 text-sm bg-green-500 text-white rounded-lg hover:bg-green-600",children:"Editar"}),e.jsx("button",{onClick:()=>w(s.id),className:"flex-1 py-2 px-3 text-sm bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Eliminar"})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Título"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Boletos"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Acciones"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.title}),e.jsx("div",{className:"text-sm text-gray-500",children:g(new Date(s.drawDate),"dd MMM, yyyy")})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[s.sold," / ",s.tickets]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:k(s.status)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>v(s),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Editar"}),e.jsx("button",{onClick:()=>w(s.id),className:"text-red-600 hover:text-red-900",children:"Eliminar"})]})]},s.id))})]})})]})}),e.jsx(r,{children:c&&e.jsx(b,{raffle:j,onClose:N,onSave:async e=>{try{if(e.id)await p(e);else{const{id:s,sold:t,...a}=e;await h(a)}y(),N()}catch(s){console.error(s),alert("Error al guardar la rifa.")}}})})]})};export{f as default};
