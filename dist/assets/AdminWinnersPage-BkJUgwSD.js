import{j as e,X as a,Z as t,Y as r,_ as s,$ as l,O as i,m as o,a0 as n,f as d,a1 as c,P as m,A as x,w as u}from"./ui-CC9fDAxl.js";import{r as h}from"./router-DKHyH_C6.js";import{S as b,w as g,i as p,x as f,y,z as j,A as v}from"./index-DmsZdVbW.js";import"./vendor-By4jc1MA.js";const w=({raffles:d,onSave:c,onCancel:m})=>{const[x,u]=h.useState({name:"",raffleId:"",ticketNumber:"",phone:"",city:"",testimonial:"",imageFile:null,imagePreview:""}),[b,g]=h.useState(!1),p=h.useRef(null),f=e=>{const{name:a,value:t}=e.target;u(e=>({...e,[a]:t}))},y=e=>new Promise((a,t)=>{const r=new FileReader;r.onload=()=>{const e=r.result.split(",")[1];a(e)},r.onerror=t,r.readAsDataURL(e)});return e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),g(!0);try{const e=d.find(e=>e.id===x.raffleId);if(!e)return void alert("Por favor selecciona un sorteo");let t=e.heroImage||"";if(x.imageFile)try{const e=await y(x.imageFile);t=`data:${x.imageFile.type};base64,${e}`}catch(a){console.error("Error converting image:",a),alert("Error al procesar la imagen. Usando imagen por defecto.")}else x.imagePreview&&(t=x.imagePreview);const r={name:x.name,raffleId:x.raffleId,raffleTitle:e.title,prize:e.title,drawDate:new Date,ticketNumber:x.ticketNumber?parseInt(x.ticketNumber):void 0,phone:x.phone||void 0,city:x.city||void 0,testimonial:x.testimonial||void 0,imageUrl:t};await c(r)}finally{g(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Agregar Ganador Manual"}),e.jsx("button",{type:"button",onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(a,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(t,{className:"w-4 h-4 inline mr-2"}),"Sorteo *"]}),e.jsxs("select",{name:"raffleId",value:x.raffleId,onChange:f,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"-- Selecciona un sorteo --"}),d.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(r,{className:"w-4 h-4 inline mr-2"}),"Nombre del Ganador *"]}),e.jsx("input",{type:"text",name:"name",value:x.name,onChange:f,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nombre completo",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Número de Boleto Ganador"}),e.jsx("input",{type:"number",name:"ticketNumber",value:x.ticketNumber,onChange:f,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ej: 42"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(s,{className:"w-4 h-4 inline mr-2"}),"Teléfono"]}),e.jsx("input",{type:"tel",name:"phone",value:x.phone,onChange:f,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ej: 99999999"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(l,{className:"w-4 h-4 inline mr-2"}),"Ciudad"]}),e.jsx("input",{type:"text",name:"city",value:x.city,onChange:f,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ej: Tegucigalpa"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(i,{className:"w-4 h-4 inline mr-2"}),"Foto del Ganador"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[x.imagePreview&&e.jsx(o.img,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},src:x.imagePreview,alt:"Preview",className:"w-24 h-24 object-cover rounded-lg border-2 border-gray-300"}),e.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()},className:"px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors",children:x.imagePreview?"Cambiar Foto":"Subir Foto"}),e.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];t&&u(e=>({...e,imageFile:t,imagePreview:URL.createObjectURL(t)}))},className:"hidden"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Sube una foto del ganador para generar confianza"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[e.jsx(n,{className:"w-4 h-4 inline mr-2"}),"Testimonio (Opcional)"]}),e.jsx("textarea",{name:"testimonial",value:x.testimonial,onChange:f,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"Un testimonio del ganador sobre cómo se sintió al ganar..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:m,disabled:b,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:b,className:"px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Guardando...":"Guardar Ganador"})]})]})},N=({isRunning:a,winnerNumber:t,onComplete:r})=>{const[s,l]=h.useState(0),[i,n]=h.useState(3),[m,x]=h.useState(!1);return h.useEffect(()=>{if(a){x(!1),n(3);const e=setInterval(()=>{i>0&&l(Math.floor(1e3*Math.random())+1)},100),a=setInterval(()=>{n(e=>e<=1?(clearInterval(a),setTimeout(()=>{null!==t&&(l(t),x(!0),setTimeout(()=>{null==r||r()},2e3))},100),0):e-1)},1e3);return()=>{clearInterval(e),clearInterval(a)}}},[a,t,r,i]),h.useEffect(()=>{a||null===t||m||(l(t),x(!0))},[a,t,m]),a||m?e.jsxs("div",{className:"relative w-full h-96 flex items-center justify-center bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map((a,t)=>e.jsx(o.div,{className:"absolute w-2 h-2 bg-yellow-400 rounded-full",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:0},animate:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:[0,1,0],scale:[1,1.5,1]},transition:{duration:2+2*Math.random(),repeat:1/0,delay:2*Math.random()}},t))}),e.jsx("div",{className:"relative z-10 text-center",children:m?e.jsxs(o.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15},className:"space-y-8",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(50)].map((a,t)=>e.jsx(o.div,{className:"absolute w-3 h-3 rounded-full",style:{background:["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#FFA07A"][t%5],left:7*t%100+"%",top:"-10%"},animate:{y:["0%","120%"],x:[0,200*Math.random()-100],rotate:[0,360],opacity:[1,0]},transition:{duration:2+Math.random(),delay:.5*Math.random()}},t))}),e.jsx(o.div,{animate:{y:[0,-20,0],rotate:[0,10,-10,0]},transition:{duration:.5,repeat:1/0},className:"flex justify-center",children:e.jsx(d,{className:"w-32 h-32 text-yellow-400 drop-shadow-2xl"})}),e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[e.jsx("p",{className:"text-3xl font-bold text-white mb-4",children:"¡¡¡ GANADOR !!!"}),e.jsx("div",{className:"text-9xl font-bold text-yellow-400 drop-shadow-2xl",children:s.toString().padStart(4,"0")})]})]}):e.jsxs(o.div,{initial:{scale:0},animate:{scale:1,rotate:360},transition:{duration:.5},className:"space-y-8",children:[e.jsx(o.div,{animate:{rotate:360,scale:[1,1.2,1]},transition:{rotate:{duration:1,repeat:1/0,ease:"linear"},scale:{duration:.5,repeat:1/0}},className:"flex justify-center",children:e.jsx(d,{className:"w-32 h-32 text-yellow-400"})}),e.jsx(o.div,{initial:{scale:0,y:50,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:0,y:-50,opacity:0},transition:{duration:.1},className:"text-8xl font-bold text-white drop-shadow-2xl",children:s.toString().padStart(4,"0")},s),e.jsxs(o.div,{initial:{scale:0},animate:{scale:[1,1.5,1]},transition:{duration:.5,repeat:1/0},className:"flex items-center justify-center gap-2 text-white",children:[e.jsx(c,{className:"w-6 h-6 text-yellow-400"}),e.jsx("span",{className:"text-2xl font-bold",children:i>0?`Seleccionando ganador en ${i}...`:"Decidiendo ganador..."}),e.jsx(c,{className:"w-6 h-6 text-yellow-400"})]})]})})]}):null},k=()=>{var a,t,r,s,l;const[i,n]=h.useState([]),[c,k]=h.useState([]),[S,C]=h.useState([]),[F,D]=h.useState(""),[G,A]=h.useState(!1),[z,M]=h.useState(!1),[E,I]=h.useState(null),[P,R]=h.useState(null),[T,U]=h.useState(!0),[L,B]=h.useState(!1),[O,H]=h.useState(!1),$=async()=>{U(!0);try{const[e,a,t]=await Promise.all([g(),p(),f()]);n(e),k(a),C(t)}catch(e){R("Error al cargar los datos.")}finally{U(!1)}};h.useEffect(()=>{$()},[]);const q=()=>{H(!0)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-xl",children:e.jsx(d,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Ganadores"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona los ganadores de tus sorteos"})]})]}),e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:"Agregar Ganador Manual"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Realizar un Sorteo Aleatorio"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"raffle-select",className:"text-sm font-semibold text-gray-700 mb-1 block",children:"Selecciona un Sorteo Finalizado"}),e.jsxs("select",{id:"raffle-select",value:F,onChange:e=>{D(e.target.value),I(null),R(null),H(!1)},className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:G,children:[e.jsx("option",{value:"",children:"-- Elige un sorteo --"}),i.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))]})]}),e.jsxs("button",{onClick:async()=>{if(F){A(!0),R(null),I(null),M(!0),H(!1);try{setTimeout(async()=>{try{const e=await y(F);I(e)}catch(e){R(e.message||"Ocurrió un error al realizar el sorteo."),M(!1)}finally{A(!1)}},4e3)}catch(e){R(e.message||"Ocurrió un error al realizar el sorteo."),M(!1),A(!1)}}},disabled:!F||G,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-xl flex items-center justify-center gap-2 disabled:bg-gray-400 transition-colors",children:[e.jsx(d,{className:"w-5 h-5"}),G?"Sorteando...":"Realizar Sorteo"]})]})]}),e.jsx(x,{children:(z||E||P)&&e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6",children:z&&!P&&E?e.jsx(N,{isRunning:G,winnerNumber:E.ticket,onComplete:q}):!z||E||P?P?e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-red-200",children:e.jsx("p",{className:"text-center text-red-600 font-semibold",children:P})}):E&&!z?e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 border-4 border-yellow-400 rounded-2xl shadow-2xl p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(d,{className:"h-20 w-20 text-yellow-500"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"¡¡¡ GANADOR !!!"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border-4 border-yellow-400 p-8 mb-6 transform hover:scale-105 transition-transform",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Boleto Ganador"}),e.jsx("p",{className:"text-8xl font-bold text-yellow-500 my-4 drop-shadow-lg",children:E.ticket}),e.jsxs("div",{className:"border-t-2 border-gray-200 pt-4 mt-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:(null==(a=E.order.customer)?void 0:a.name)||E.order.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Folio: ",E.order.folio]}),(null==(t=E.order.customer)?void 0:t.phone)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Teléfono: ",E.order.customer.phone]}),(null==(r=E.order.customer)?void 0:r.district)&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Ciudad: ",E.order.customer.district]})]})]}),e.jsxs("div",{className:"bg-blue-100 rounded-xl p-4 mb-6",children:[e.jsxs("p",{className:"text-lg font-semibold text-blue-900",children:["Rifa: ",(null==(s=i.find(e=>e.id===F))?void 0:s.title)||"Sin título"]}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Fecha de sorteo: ",new Date((null==(l=i.find(e=>e.id===F))?void 0:l.drawDate)||new Date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsxs("button",{onClick:()=>{I(null),M(!1),D("")},className:"flex items-center justify-center gap-2 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Volver a Seleccionar"]}),e.jsxs("button",{onClick:async()=>{var e,a;if(!E)return;const t=i.find(e=>e.id===F);if(!t)return;const r={name:(null==(e=E.order.customer)?void 0:e.name)||E.order.name,prize:t.title,imageUrl:t.heroImage||t.imageUrl,raffleTitle:t.title,drawDate:t.drawDate,ticketNumber:E.ticket};await j(r),alert(`¡Ganador ${(null==(a=E.order.customer)?void 0:a.name)||E.order.name} guardado con éxito!`),I(null),D(""),H(!1),$()},className:"flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Confirmar Ganador"]})]})]})}):null:e.jsx(N,{isRunning:G,winnerNumber:null,onComplete:q})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Historial de Ganadores"}),e.jsx("div",{className:"space-y-3",children:T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{})}):S.length>0?S.map(a=>e.jsxs("div",{className:"flex justify-between items-center p-4 border border-gray-200 rounded-xl hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[a.imageUrl&&e.jsx("img",{src:a.imageUrl,alt:a.name,className:"w-12 h-12 rounded-full object-cover border-2 border-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.raffleTitle}),a.ticketNumber&&e.jsxs("p",{className:"text-xs text-blue-600",children:["Boleto: ",a.ticketNumber]})]})]}),e.jsx("button",{onClick:()=>(async e=>{window.confirm("¿Estás seguro de que quieres eliminar a este ganador?")&&(await v(e),$())})(a.id),className:"p-2 text-red-500 hover:bg-red-50 rounded-full transition-colors",children:e.jsx(u,{size:18})})]},a.id)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Aún no hay ganadores registrados."})})]})]}),e.jsx(x,{children:L&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>B(!1),children:e.jsx(o.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsx("div",{className:"p-6",children:e.jsx(w,{raffles:c,onSave:async e=>{try{const a={name:e.name,prize:e.prize,imageUrl:e.imageUrl,raffleTitle:e.raffleTitle,drawDate:e.drawDate,ticketNumber:e.ticketNumber,phone:e.phone,city:e.city,testimonial:e.testimonial};await j(a),alert("¡Ganador guardado exitosamente!"),B(!1),$()}catch(a){alert("Error al guardar ganador: "+a.message)}},onCancel:()=>B(!1)})})})})})]})};export{k as default};
