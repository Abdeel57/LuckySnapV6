import{j as e,A as s,m as a,X as r,N as t,R as l,W as n,V as i,S as o,t as c,x as d,e as x,d as m,K as h}from"./ui-CC9fDAxl.js";import{r as u}from"./router-DKHyH_C6.js";import{p,i as g,q as j,r as b,s as f,t as y}from"./index-DmsZdVbW.js";import{E as N}from"./EditOrderForm-BUKBXWUC.js";import"./vendor-By4jc1MA.js";import"./index.esm-kOr9XXcU.js";const v=({isOpen:l,onClose:n,onSave:i})=>{const[o,c]=u.useState("Transferencia"),[d,x]=u.useState("");return l?e.jsx(s,{children:l&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4",onClick:n,children:e.jsxs(a.div,{initial:{scale:.9,y:-20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-white rounded-2xl shadow-2xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 p-6 text-white rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Marcar como Pagado"}),e.jsx("p",{className:"text-green-100 mt-1",children:"Confirma los detalles del pago"})]}),e.jsx("button",{onClick:n,className:"bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all duration-200 p-2 rounded-xl",children:e.jsx(r,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),i(o,d),c("Transferencia"),x("")},className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"M√©todo de Pago"}),e.jsxs("select",{value:o,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-xl bg-white text-gray-800 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all",required:!0,children:[e.jsx("option",{value:"Transferencia",children:"Transferencia"}),e.jsx("option",{value:"Dep√≥sito en Efectivo",children:"Dep√≥sito en Efectivo"}),e.jsx("option",{value:"Punto de Venta",children:"Punto de Venta"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Notas (Opcional)"}),e.jsx("textarea",{value:d,onChange:e=>x(e.target.value),rows:4,className:"w-full p-3 border border-gray-300 rounded-xl bg-white text-gray-800 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none",placeholder:"Agrega alg√∫n comentario sobre este pago..."})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all flex items-center space-x-2",children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:"Confirmar Pago"})]})]})]})]})})}):null},w=()=>{var r,t;const[w,E]=u.useState([]),[C,k]=u.useState([]),[S,O]=u.useState(!0),[P,D]=u.useState(!1),[L,A]=u.useState(""),[T,z]=u.useState(null),[M,$]=u.useState(!1),[I,B]=u.useState(null),[V,F]=u.useState(!1),[q,G]=u.useState(!1),[R,J]=u.useState(!1),[K,U]=u.useState(null);u.useEffect(()=>{W()},[]);const W=async()=>{try{O(!0);const[e,s]=await Promise.all([p(),g()]);E(e||[]),k(s||[]),console.log("üìã Orders and raffles loaded:",{orders:(null==e?void 0:e.length)||0,raffles:(null==s?void 0:s.length)||0})}catch(e){console.error("‚ùå Error loading data:",e),alert("Error al cargar los datos. Verifica la conexi√≥n al servidor."),E([]),k([])}finally{O(!1)}},H=async()=>{D(!0),await W(),D(!1)},Q=w.filter(e=>{var s,a,r;if("PENDING"!==e.status)return!1;if(!e.customer)return!1;return e.folio.toLowerCase().includes(L.toLowerCase())||(null==(s=e.customer.name)?void 0:s.toLowerCase().includes(L.toLowerCase()))||(null==(a=e.customer.phone)?void 0:a.includes(L))||(null==(r=e.customer.district)?void 0:r.toLowerCase().includes(L.toLowerCase()))}),X=async(e,s)=>{try{if(D(!0),"COMPLETED"===s)return void(e=>{U(e),J(!0)})(e);await j(e,{status:s}),console.log("‚úÖ Order status updated:",{orderId:e,newStatus:s}),alert(`Estado de la orden actualizado a: ${s}`),await H()}catch(a){console.error("‚ùå Error updating order status:",a),alert(`Error al actualizar el estado de la orden: ${a.message||"Error desconocido"}`)}finally{D(!1)}},Y=()=>{z(null),$(!1)},Z=e=>{B(e),F(!0)},_=()=>{B(null),F(!1)};return S?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando √≥rdenes..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(n,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Apartados Pendientes"}),e.jsx("p",{className:"text-gray-600",children:"√ìrdenes pendientes de pago"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:H,disabled:P,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(l,{className:"w-4 h-4 "+(P?"animate-spin":"")}),e.jsx("span",{children:"Actualizar"})]}),e.jsxs("button",{onClick:()=>{try{const e=w.filter(e=>e.customer&&e.tickets),s=JSON.stringify(e,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(s),r=`ordenes-${(new Date).toISOString().split("T")[0]}.json`,t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){console.error("Error exporting orders:",e),alert("Error al exportar las √≥rdenes")}},className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:"Exportar"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-4 mb-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(o,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar por folio, cliente, tel√©fono o email...",value:L,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(s,{children:Q.map(s=>{var r;return e.jsxs(a.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.folio}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[s.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["üë§ ",s.customer.name||"Sin nombre"]}),e.jsxs("p",{children:["üìû ",s.customer.phone||"Sin tel√©fono"]})]}),e.jsxs("p",{children:["üé´ Boletos: ",(null==(r=s.tickets)?void 0:r.join(", "))||"N/A"]}),e.jsxs("p",{className:"font-bold text-green-600",children:["üí∞ $",(s.totalAmount||s.total||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>(e=>{z(e),$(!0)})(s),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:"Ver"})]}),e.jsxs("button",{onClick:()=>Z(s),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar"})]}),e.jsxs("button",{onClick:()=>X(s.id,"COMPLETED"),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors text-sm",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:"Marcar Pagado"})]}),e.jsxs("button",{onClick:()=>(async e=>{if(window.confirm("¬øEst√°s seguro de que quieres eliminar esta orden? Esto no se puede deshacer."))try{D(!0),await b(e),await H(),console.log("‚úÖ Order deleted:",e),alert("Orden eliminada exitosamente")}catch(s){console.error("‚ùå Error deleting order:",s),alert(`Error al eliminar la orden: ${s.message||"Error desconocido"}`)}finally{D(!1)}})(s.id),className:"flex items-center justify-center space-x-2 px-3 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition-colors text-sm",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:"Eliminar"})]})]})]},s.id)})}),0===Q.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay √≥rdenes"}),e.jsx("p",{className:"text-gray-600",children:L?"No se encontraron √≥rdenes con los filtros aplicados":"A√∫n no hay √≥rdenes registradas"})]})]})]}),e.jsx(s,{children:M&&T&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:Y,children:e.jsx(a.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Detalles de la Orden"}),e.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(m,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Informaci√≥n B√°sica"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Folio:"}),e.jsx("p",{className:"font-medium",children:T.folio})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Estado:"}),e.jsx("p",{className:"font-medium",children:T.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Fecha:"}),e.jsx("p",{className:"font-medium",children:new Date(T.createdAt).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total:"}),e.jsxs("p",{className:"font-bold text-green-600",children:["$",(T.totalAmount||T.total||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Cliente"}),e.jsxs("div",{className:"space-y-2",children:[T.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Nombre:"}),e.jsx("p",{className:"font-medium",children:T.customer.name||"Sin nombre"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Tel√©fono:"}),e.jsx("p",{className:"font-medium",children:T.customer.phone||"Sin tel√©fono"})]})]}),T.customer.district&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Distrito:"}),e.jsx("p",{className:"font-medium",children:T.customer.district})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Boletos"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cantidad:"}),e.jsx("p",{className:"font-medium",children:(null==(r=T.tickets)?void 0:r.length)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"N√∫meros:"}),e.jsx("p",{className:"font-medium",children:(null==(t=T.tickets)?void 0:t.join(", "))||"N/A"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>{Y(),Z(T)},className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar"})]}),"PENDING"===T.status&&e.jsxs("button",{onClick:()=>{Y(),X(T.id,"COMPLETED")},disabled:q,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors disabled:opacity-50",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:"Marcar Pagado"})]}),"COMPLETED"===T.status&&e.jsxs("button",{onClick:()=>{Y(),(async e=>{if(window.confirm("¬øEst√°s seguro de liberar estos boletos? Volver√°n al inventario."))try{G(!0),await f(e),await H(),Y(),console.log("‚úÖ Order released successfully"),alert("‚úÖ Boletos liberados correctamente")}catch(s){console.error("‚ùå Error releasing order:",s),alert(`‚ùå Error: ${s.message||"Error al liberar la orden"}`)}finally{G(!1)}})(T.id)},disabled:q,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-yellow-600 text-white rounded-xl hover:bg-yellow-700 transition-colors disabled:opacity-50",children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{children:"Liberar Boletos"})]})]})]})]})})})}),e.jsx(v,{isOpen:R,onClose:()=>{J(!1),U(null)},onSave:async(e,s)=>{if(K)try{D(!0),await y(K,e,s),console.log("‚úÖ Order marked as paid:",{orderId:K,paymentMethod:e,notes:s}),alert("Orden marcada como pagada exitosamente"),await H(),J(!1),U(null)}catch(a){console.error("‚ùå Error marking order as paid:",a),alert(`Error al marcar la orden como pagada: ${a.message||"Error desconocido"}`)}finally{D(!1)}}}),e.jsx(s,{children:V&&I&&e.jsx(a.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:_,children:e.jsx(a.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Editar Orden"}),e.jsx("button",{onClick:_,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:e.jsx(m,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx(N,{order:I,onSave:async e=>{try{G(!0),await j(e.id,e),await H(),_(),console.log("‚úÖ Order updated successfully"),alert("‚úÖ Orden actualizada correctamente")}catch(s){console.error("‚ùå Error updating order:",s),alert(`‚ùå Error: ${s.message||"Error al actualizar la orden"}`)}finally{G(!1)}},onCancel:_})]})})})})]})};export{w as default};
