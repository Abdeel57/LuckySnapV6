import{j as e,m as a,c as s,A as t,n as l}from"./ui-BjxIis6X.js";import{r}from"./router-Cu2lpERZ.js";import{S as i,o as n,p as d,q as o,s as c,r as m}from"./index-jkHuebR5.js";import"./vendor-DOHx2j1n.js";const x=()=>{const[x,u]=r.useState([]),[h,b]=r.useState([]),[g,j]=r.useState(""),[f,p]=r.useState(!1),[y,N]=r.useState(null),[w,v]=r.useState(null),[S,z]=r.useState(!0),k=async()=>{z(!0);try{const[e,a]=await Promise.all([n(),d()]);u(e),b(a)}catch(e){v("Error al cargar los datos.")}finally{z(!1)}};r.useEffect(()=>{k()},[]);return e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"Ganadores"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Realizar un Sorteo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"raffle-select",className:"text-sm text-gray-600 mb-1 block",children:"Selecciona un Sorteo Finalizado"}),e.jsxs("select",{id:"raffle-select",value:g,onChange:e=>{j(e.target.value),N(null),v(null)},className:"w-full bg-gray-50 p-2.5 rounded-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500",disabled:f,children:[e.jsx("option",{value:"",children:"-- Elige un sorteo --"}),x.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))]})]}),e.jsxs("button",{onClick:async()=>{if(g){p(!0),v(null),N(null);try{const e=await o(g);N(e)}catch(e){v(e.message||"Ocurrió un error al realizar el sorteo.")}finally{p(!1)}}},disabled:!g||f,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 px-4 rounded-md flex items-center justify-center gap-2 disabled:bg-gray-400 transition-colors",children:[e.jsx(s,{className:"w-5 h-5"}),f?"Sorteando...":"Realizar Sorteo"]})]})]}),e.jsx(t,{children:(f||y||w)&&e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6 bg-white p-6 rounded-lg shadow-md min-h-[10rem] flex items-center justify-center",children:[f&&e.jsx(i,{}),w&&e.jsx("p",{className:"text-center text-red-500 font-semibold",children:w}),y&&e.jsxs("div",{className:"text-center",children:[e.jsx(s,{className:"mx-auto h-16 w-16 text-yellow-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"¡El boleto ganador es el!"}),e.jsx("p",{className:"text-6xl font-bold text-blue-600 my-2",children:y.ticket}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-800",children:["Felicidades a ",e.jsx("span",{className:"text-blue-500",children:y.order.name})]}),e.jsxs("p",{className:"text-gray-500",children:["Folio: ",y.order.folio]}),e.jsx("button",{onClick:async()=>{if(!y)return;const e=x.find(e=>e.id===g);if(!e)return;const a={name:y.order.name,prize:e.title,imageUrl:e.heroImage,raffleTitle:e.title,drawDate:e.drawDate};await c(a),alert(`¡Ganador ${y.order.name} guardado con éxito!`),N(null),j(""),k()},className:"mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-md",children:"Guardar y Publicar Ganador"})]})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Historial de Ganadores"}),e.jsx("div",{className:"space-y-3",children:S?e.jsx(i,{}):h.length>0?h.map(a=>e.jsxs("div",{className:"flex justify-between items-center p-3 border rounded-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.prize})]}),e.jsx("button",{onClick:()=>(async e=>{window.confirm("¿Estás seguro de que quieres eliminar a este ganador?")&&(await m(e),k())})(a.id),className:"p-2 text-red-500 hover:bg-red-100 rounded-full",children:e.jsx(l,{size:18})})]},a.id)):e.jsx("p",{className:"text-gray-500",children:"Aún no hay ganadores registrados."})})]})]})};export{x as default};
