import{j as e,R as s,Y as a,S as l,A as t,m as r,t as i,x as n,K as c}from"./ui-CC9fDAxl.js";import{r as o}from"./router-DKHyH_C6.js";import{p as d,s as x,q as m}from"./index-DmsZdVbW.js";import{E as h}from"./EditOrderForm-BUKBXWUC.js";import"./vendor-By4jc1MA.js";import"./index.esm-kOr9XXcU.js";const u=()=>{var u;const[p,j]=o.useState([]),[b,g]=o.useState(!0),[y,f]=o.useState(!1),[N,v]=o.useState(""),[w,C]=o.useState(null),[S,k]=o.useState(!1),[E,A]=o.useState(null),[L,z]=o.useState(!1),[D,B]=o.useState(!1);o.useEffect(()=>{O()},[]);const O=async()=>{try{g(!0);const e=await d(1,200);j(Array.isArray(e)?e:[])}catch(e){console.error("Error cargando órdenes:",e),alert("Error al cargar datos. Verifica el servidor."),j([])}finally{g(!1)}},P=async()=>{f(!0),await O(),f(!1)},$=o.useMemo(()=>{const e=p.filter(e=>(e=>{if(!e)return!1;const s=String(e).toUpperCase();return"PAID"===s||"COMPLETED"===s})(String(e.status)));if(!N)return e;const s=N.toLowerCase();return e.filter(e=>{var a,l,t,r,i,n,c,o,d;const x=(null==(t=null==(l=null==(a=e.customer)?void 0:a.name)?void 0:l.toLowerCase)?void 0:t.call(l))||"",m=(null==(r=e.customer)?void 0:r.phone)||"",h=(null==(c=null==(n=null==(i=e.customer)?void 0:i.district)?void 0:n.toLowerCase)?void 0:c.call(n))||"",u=(null==(o=e.folio)?void 0:o.toLowerCase())||"",p=(null==(d=e.tickets)?void 0:d.some(e=>e.toString().includes(N)))||!1;return x.includes(s)||m.includes(N)||h.includes(s)||u.includes(s)||p})},[p,N]),F=e=>{A(e),z(!0)},M=()=>{C(null),k(!1)},V=()=>{A(null),z(!1)},I=async e=>{if(window.confirm("¿Estás seguro de liberar estos boletos? Volverán al inventario."))try{B(!0),await x(e),await P(),M(),V(),console.log("✅ Boletos liberados"),alert("✅ Boletos liberados correctamente")}catch(s){console.error("❌ Error al liberar orden:",s),alert(`❌ Error: ${s.message||"Error al liberar la orden"}`)}finally{B(!1)}};return b?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(s,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando clientes..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(a,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Clientes Pagados"}),e.jsx("p",{className:"text-gray-600",children:"Órdenes con pago confirmado"})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("button",{onClick:P,disabled:y,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(s,{className:"w-4 h-4 "+(y?"animate-spin":"")}),e.jsx("span",{children:"Actualizar"})]})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-4 mb-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, teléfono, distrito, folio o número de boleto...",value:N,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(t,{children:$.map(s=>{var a;return e.jsxs(r.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"mb-4",children:[s.customer&&e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s.customer.name||"Sin nombre"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[s.customer&&e.jsxs("p",{children:["📞 ",s.customer.phone||"Sin teléfono"]}),e.jsxs("p",{children:["🎫 Boletos: ",(null==(a=s.tickets)?void 0:a.join(", "))||"N/A"]}),e.jsxs("p",{className:"font-bold text-green-600",children:["💰 $",(s.totalAmount||s.total||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>(e=>{C(e),k(!0)})(s),disabled:D,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors text-sm disabled:opacity-50",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{children:"Ver"})]}),e.jsxs("button",{onClick:()=>F(s),disabled:D,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors text-sm disabled:opacity-50",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar"})]}),e.jsxs("button",{onClick:()=>I(s.id),disabled:D,className:"flex items-center justify-center space-x-2 px-3 py-2 bg-yellow-600 text-white rounded-xl hover:bg-yellow-700 transition-colors text-sm disabled:opacity-50",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:"Liberar"})]})]})]},s.id)})}),0===$.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(a,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No hay clientes"}),e.jsx("p",{className:"text-gray-600",children:N?"No se encontraron clientes con los filtros aplicados":"Aún no hay clientes pagados"})]})]})]}),e.jsx(t,{children:S&&w&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:M,children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Detalles del Cliente"}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:"✕"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Información"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.customer&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Nombre:"}),e.jsx("p",{className:"font-medium",children:w.customer.name||"Sin nombre"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Teléfono:"}),e.jsx("p",{className:"font-medium",children:w.customer.phone||"Sin teléfono"})]})]}),(null==(u=w.customer)?void 0:u.district)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Distrito:"}),e.jsx("p",{className:"font-medium",children:w.customer.district})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Fecha:"}),e.jsx("p",{className:"font-medium",children:w.createdAt?new Date(w.createdAt).toLocaleDateString("es-ES"):""})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Monto:"}),e.jsxs("p",{className:"font-bold text-green-600",children:["$",(w.totalAmount||w.total||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Boletos"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cantidad:"}),e.jsx("p",{className:"font-medium",children:w.tickets.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Números:"}),e.jsx("p",{className:"font-medium",children:w.tickets.join(", ")})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>{M(),F(w)},disabled:D,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors disabled:opacity-50",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Editar"})]}),e.jsxs("button",{onClick:()=>{M(),I(w.id)},disabled:D,className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-yellow-600 text-white rounded-xl hover:bg-yellow-700 transition-colors disabled:opacity-50",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:"Liberar"})]})]})]})]})})})}),e.jsx(t,{children:L&&E&&e.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:V,children:e.jsx(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Editar Orden"}),e.jsx("button",{onClick:V,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:"✕"})]}),e.jsx(h,{order:E,onSave:async e=>{try{B(!0),await m(e.id,e),await P(),V(),console.log("✅ Orden actualizada"),alert("✅ Orden actualizada correctamente")}catch(s){console.error("❌ Error al actualizar orden:",s),alert(`❌ Error: ${s.message||"Error al actualizar la orden"}`)}finally{B(!1)}},onCancel:V})]})})})})]})};export{u as default};
